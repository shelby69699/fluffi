<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluffFi - The Cleverest Fox on Cardano</title>
    <meta name="description" content="The cleverest fox on Cardano is here. Let's make DeFi simpler, smarter, and better.">
    <link rel="icon" href="./images/3ed7b15d-65d7-4b9f-b73f-a3923e3817a4.png" type="image/png">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://shelby69699.github.io/fluffi/">
    <meta property="og:title" content="FluffFi - The Cleverest Fox on Cardano">
    <meta property="og:description" content="The cleverest fox on Cardano is here. Let's make DeFi simpler, smarter, and better.">
    <meta property="og:image" content="https://shelby69699.github.io/fluffi/images/3ed7b15d-65d7-4b9f-b73f-a3923e3817a4.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://shelby69699.github.io/fluffi/">
    <meta property="twitter:title" content="FluffFi - The Cleverest Fox on Cardano">
    <meta property="twitter:description" content="The cleverest fox on Cardano is here. Let's make DeFi simpler, smarter, and better.">
    <meta property="twitter:image" content="https://shelby69699.github.io/fluffi/images/3ed7b15d-65d7-4b9f-b73f-a3923e3817a4.png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #ffd89b 100%);
            background-attachment: fixed;
            min-height: 100vh;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text x="4" y="24" font-size="20">üêæ</text></svg>'), auto;
        }

        /* Top Navigation - Single Clean Header */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: absolute;
            left: 2rem;
        }

        .fox-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 2px;
        }

        .fox-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .brand-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff6b35;
        }

        .header-nav {
            display: flex;
            list-style: none;
            gap: 2rem;
            margin: 0;
            align-items: center;
        }

        .header-nav a {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }

        .header-nav a:hover {
            color: #ff6b35;
        }

        .header-staking-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .header-staking-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        /* Remove old navigation styles */
        .top-nav,
        .logo-section,
        .secondary-nav {
            display: none;
        }

        /* Hide the separate wallet section */
        .wallet-section {
            display: none;
        }

        /* Main Content */
        .main-content {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 4rem;
            padding-top: 2rem;
        }

        .hero-fox-logo {
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem auto;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-fox-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #ff6b35;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .hero-title .fluffi-text {
            background: linear-gradient(45deg, #ff6b35, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-title .paw-prints {
            font-size: 3rem;
            color: #8b5cf6;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 3rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: #8b5cf6;
            padding: 1rem 2rem;
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-secondary:hover {
            background: #8b5cf6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        /* Wallet Section */
        .wallet-section {
            position: fixed;
            top: 1rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1000;
        }

        .staking-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .staking-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .wallet-address {
            background: rgba(0, 0, 0, 0.05);
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #666;
            border: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wallet-address:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        /* Staking Modal */
        .staking-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .staking-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #333;
            text-align: center;
        }

        .wallet-status {
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #666;
        }

        .staking-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .connect-wallet-btn {
            background: linear-gradient(45deg, #8b5cf6, #6366f1);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .connect-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        .stake-now-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .stake-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .stake-now-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .staking-info {
            background: linear-gradient(45deg, rgba(255, 107, 53, 0.1), rgba(139, 92, 246, 0.1));
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .staking-info h3 {
            color: #ff6b35;
            margin-bottom: 0.5rem;
        }

        .staking-info p {
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .wallet-section {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin-top: 2rem;
            }

            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }

            .main-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .header-left {
                justify-content: center;
            }

            .header-nav {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .header-staking-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .fox-logo {
                width: 40px;
                height: 40px;
            }

            .brand-text {
                font-size: 1.3rem;
            }

            .hero-title {
                font-size: 2.5rem;
                flex-direction: column;
                gap: 0.2rem;
            }

            .hero-title .paw-prints {
                font-size: 2rem;
            }

            .hero-fox-logo {
                width: 150px;
                height: 150px;
                margin-bottom: 1.5rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn-primary, .btn-secondary {
                width: 200px;
                justify-content: center;
            }
        }

        /* Custom paw cursor for interactive elements */
        a, button, .header-staking-btn, .btn-primary, .btn-secondary, .connect-wallet-btn, .stake-now-btn, .modal-close, .fox-logo, .hero-fox-logo {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text x="4" y="24" font-size="18">üêæ</text></svg>'), pointer !important;
        }

        /* Special paw cursor for wallet address */
        .wallet-address {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text x="4" y="24" font-size="18">üêæ</text></svg>'), copy !important;
        }

        /* Text selection cursor */
        input, textarea {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text x="4" y="24" font-size="18">üêæ</text></svg>'), text !important;
        }
    </style>
</head>
<body>
    <!-- Wallet Section -->
    <div class="wallet-section" style="display: none;">
        <button class="staking-btn" id="openStakingModal">Staking</button>
        <div class="wallet-address" id="walletAddress" title="Click to copy">addr1qx...7k2m</div>
    </div>

    <!-- Main Header -->
    <nav class="main-header">
        <div class="header-left">
            <div class="fox-logo">
                <img src="./images/3ed7b15d-65d7-4b9f-b73f-a3923e3817a4.png" alt="FluffFi Fox Logo">
            </div>
            <div class="brand-text">FluffFi</div>
        </div>
        <ul class="header-nav">
            <li><a href="#tokenomics">Tokenomics</a></li>
            <li><a href="#community">Community</a></li>
            <li><a href="#roadmap">Roadmap</a></li>
            <li><button class="header-staking-btn" id="openStakingModal">Staking</button></li>
        </ul>
    </nav>

    <!-- Staking Modal -->
    <div class="staking-modal" id="stakingModal">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">&times;</button>
            <h2 class="modal-title">ü¶ä FluffFi Staking</h2>
            
            <div class="staking-info">
                <h3>Real ADA Staking</h3>
                <p>Stake your ADA directly through Eternal Wallet. Your ADA goes directly to our staking pool for rewards!</p>
                <p style="font-size: 0.8rem; color: #ff6b35; margin-top: 0.5rem;">‚ö†Ô∏è Minimum 1 ADA + transaction fees (~1-2 ADA extra needed)</p>
            </div>

            <div class="wallet-status" id="walletStatus">
                Connect your Eternal Wallet to start staking
            </div>

            <div class="staking-form">
                <button class="connect-wallet-btn" id="connectEternalBtn">
                    üîó Connect Eternal Wallet
                </button>

                <div class="form-group">
                    <label for="stakeAmount">Amount to stake (ADA):</label>
                    <input type="number" id="stakeAmount" min="1" placeholder="2" step="0.001">
                </div>

                <button class="stake-now-btn" id="stakeNowBtn" disabled>
                    üöÄ Stake ADA Now
                </button>
            </div>

            <div style="margin-top: 1rem; text-align: center; font-size: 0.8rem; color: #666;">
                <p>‚ö†Ô∏è Requires HTTPS and Eternal Wallet extension</p>
                <p>Staking address: addr1q8y94q35y2xmh8jjq...spn4a84</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <section class="hero-section">
            <div class="hero-fox-logo">
                <img src="./images/3ed7b15d-65d7-4b9f-b73f-a3923e3817a4.png" alt="FluffFi Fox Logo">
            </div>
            <h1 class="hero-title">
                <span class="fluffi-text">FluffFi</span>
                <span class="paw-prints">üêæ</span>
            </h1>
            <p class="hero-subtitle">
                Let's make DeFi simpler, smarter, and better.
            </p>
            
            <div class="cta-buttons">
                <a href="#get-started" class="btn-primary">
                    üöÄ Let's Go!
                </a>
                <a href="https://www.snek.fun/" class="btn-secondary">
                    Buy $FLUFF
                </a>
            </div>
        </section>
    </main>

    <!-- Load Cardano Serialization Library -->
    <script src="https://unpkg.com/@emurgo/cardano-serialization-lib-browser/cardano_serialization_lib.js"></script>

    <script>
        // Staking Configuration (Updated with proper protocol handling)
        const BLOCKFROST_KEY = 'mainnetiT2DrrBlVvPSozkzPZ0ovE5uuJveWxJz';
        const RECEIVER_ADDRESS = 'addr1q8y94q35y2xmh8jjqaqpgw5h6sygku6nx9umejtegykc6e87dfl0l0wv4ys46hssj6cg9h8j9m7esgag7ez6l0xwy3gspn4a84';
        
        let walletConnected = false;
        let walletApi = null;

        // Modal Controls
        const stakingModal = document.getElementById('stakingModal');
        const openStakingModal = document.getElementById('openStakingModal');
        const closeModal = document.getElementById('closeModal');
        const connectEternalBtn = document.getElementById('connectEternalBtn');
        const stakeNowBtn = document.getElementById('stakeNowBtn');
        const walletStatus = document.getElementById('walletStatus');
        const stakeAmount = document.getElementById('stakeAmount');

        // Utility function for hex conversion
        function hexToBytes(hex) {
            return Uint8Array.from(hex.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
        }

        // Fetch real protocol parameters from Blockfrost
        async function getProtocolParams() {
            try {
                const response = await fetch('https://cardano-mainnet.blockfrost.io/api/v0/epochs/latest/parameters', {
                    headers: { project_id: BLOCKFROST_KEY }
                });
                if (!response.ok) {
                    throw new Error('Failed to fetch protocol parameters');
                }
                return await response.json();
            } catch (error) {
                console.error('Protocol params fetch error:', error);
                // Fallback to hardcoded values if Blockfrost fails
                return {
                    min_fee_a: 44,
                    min_fee_b: 155381,
                    coins_per_utxo_word: "34482"
                };
            }
        }

        // Open staking modal
        openStakingModal.addEventListener('click', (e) => {
            e.preventDefault();
            stakingModal.classList.add('active');
        });

        // Close modal
        closeModal.addEventListener('click', () => {
            stakingModal.classList.remove('active');
        });

        // Close modal on backdrop click
        stakingModal.addEventListener('click', (e) => {
            if (e.target === stakingModal) {
                stakingModal.classList.remove('active');
            }
        });

        // Connect Eternal Wallet (Updated with better error handling)
        connectEternalBtn.addEventListener('click', async () => {
            // Check for HTTPS
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                alert("üîí HTTPS required! Staking only works on HTTPS sites like GitHub Pages.\nPlease access via: https://shelby69699.github.io/fluffi/");
                return;
            }

            if (!window.cardano || !window.cardano.eternl) {
                alert("ü¶ä Eternal Wallet not found!\n\nPlease:\n1. Install Eternal Wallet extension\n2. Refresh this page\n3. Try again");
                window.open('https://eternl.io/', '_blank');
                return;
            }

            try {
                connectEternalBtn.textContent = 'Connecting...';
                connectEternalBtn.disabled = true;
                
                // Enable the wallet
                await window.cardano.eternl.enable();
                walletApi = await window.cardano.eternl.enable();
                
                // Get wallet addresses
                const usedAddresses = await walletApi.getUsedAddresses();
                const address = usedAddresses[0];
                
                // Check wallet balance
                const balance = await walletApi.getBalance();
                const balanceValue = window.CardanoSerializationLib.Value.from_bytes(hexToBytes(balance));
                const adaBalance = parseInt(balanceValue.coin().to_str()) / 1000000;
                
                walletConnected = true;
                walletStatus.innerHTML = `
                    <div style="color: #10b981; font-weight: 600;">‚úÖ Wallet Connected</div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">${address.substring(0, 20)}...${address.substring(address.length - 10)}</div>
                    <div style="font-size: 0.8rem; color: #ff6b35; font-weight: 600;">Balance: ${adaBalance.toFixed(2)} ADA</div>
                `;
                connectEternalBtn.style.display = 'none';
                stakeNowBtn.disabled = false;
                
                console.log('Eternal Wallet connected successfully');
                console.log('Wallet balance:', adaBalance, 'ADA');
            } catch (err) {
                console.error('Wallet connection failed:', err);
                alert("‚ùå Failed to connect to Eternal Wallet.\n\nPlease:\n1. Ensure Eternal is unlocked\n2. Grant permission when prompted\n3. Try again");
                connectEternalBtn.textContent = 'üîó Connect Eternal Wallet';
                connectEternalBtn.disabled = false;
            }
        });

        // Stake ADA (Updated with improved transaction building)
        stakeNowBtn.addEventListener('click', async () => {
            const amountInput = stakeAmount.value;
            const amountADA = parseFloat(amountInput);
            
            if (isNaN(amountADA) || amountADA <= 0) {
                alert("‚ö†Ô∏è Please enter a valid ADA amount (minimum 0.001 ADA).");
                return;
            }

            if (amountADA < 1) {
                alert("‚ö†Ô∏è Minimum stake amount is 1 ADA to cover transaction fees.");
                return;
            }

            if (!walletConnected || !walletApi) {
                alert("‚ùå Please connect your wallet first.");
                return;
            }

            try {
                stakeNowBtn.textContent = 'Building Transaction...';
                stakeNowBtn.disabled = true;

                const csl = window.CardanoSerializationLib;
                
                // Check wallet balance first
                const balance = await walletApi.getBalance();
                const balanceValue = csl.Value.from_bytes(hexToBytes(balance));
                const adaBalance = parseInt(balanceValue.coin().to_str()) / 1000000;
                
                if (adaBalance < amountADA + 2) { // Reserve 2 ADA for fees
                    alert(`‚ùå Insufficient balance!\n\nYou have: ${adaBalance.toFixed(2)} ADA\nNeed: ${amountADA + 2} ADA (including fees)\n\nPlease reduce the amount or add more ADA to your wallet.`);
                    return;
                }

                // Fetch UTXOs
                const utxosHex = await walletApi.getUtxos();
                if (!utxosHex || utxosHex.length === 0) {
                    alert("‚ùå No UTXOs available in wallet. Please ensure your wallet has ADA.");
                    return;
                }
                const utxos = utxosHex.map(u => csl.TransactionUnspentOutput.from_bytes(hexToBytes(u)));

                stakeNowBtn.textContent = 'Fetching Protocol Parameters...';

                // Fetch protocol parameters from Blockfrost
                const protocolParams = await getProtocolParams();
                console.log('Protocol parameters:', protocolParams);

                const linearFee = csl.LinearFee.new(
                    csl.BigNum.from_str(protocolParams.min_fee_a.toString()),
                    csl.BigNum.from_str(protocolParams.min_fee_b.toString())
                );
                const coinsPerUtxoWord = csl.BigNum.from_str(protocolParams.coins_per_utxo_word.toString());

                const txBuilderCfg = csl.TransactionBuilderConfigBuilder.new()
                    .fee_algo(linearFee)
                    .coins_per_utxo_word(coinsPerUtxoWord)
                    .pool_deposit(csl.BigNum.from_str('0'))
                    .key_deposit(csl.BigNum.from_str('0'))
                    .max_value_size(5000)
                    .max_tx_size(16384)
                    .prefer_pure_change(true)
                    .build();

                const txBuilder = csl.TransactionBuilder.new(txBuilderCfg);

                stakeNowBtn.textContent = 'Building Transaction...';

                // Add inputs
                utxos.forEach(utxo => {
                    const input = utxo.input();
                    const output = utxo.output();
                    txBuilder.add_input(output.address(), input, output.amount());
                });

                // Add output
                const adaAmountLovelace = csl.BigNum.from_str((amountADA * 1000000).toString());
                const txOutput = csl.TransactionOutput.new(
                    csl.Address.from_bech32(RECEIVER_ADDRESS),
                    csl.Value.new(adaAmountLovelace)
                );
                txBuilder.add_output(txOutput);

                // Set change to first wallet address
                const usedAddresses = await walletApi.getUsedAddresses();
                const changeAddress = csl.Address.from_bech32(usedAddresses[0]);
                txBuilder.add_change_if_needed(changeAddress);

                stakeNowBtn.textContent = 'Signing Transaction...';

                // Build, sign, and submit
                const txBody = txBuilder.build();
                const tx = csl.Transaction.new(txBody, csl.TransactionWitnessSet.new());
                const txHex = Buffer.from(tx.to_bytes()).toString('hex');
                
                const signedTxHex = await walletApi.signTx(txHex, true);
                
                stakeNowBtn.textContent = 'Submitting Transaction...';
                
                const txHash = await walletApi.submitTx(signedTxHex);

                alert(`üéâ STAKING SUCCESSFUL!\n\nTransaction Hash: ${txHash}\n\nüí∞ You staked ${amountADA} ADA to FluffFi!\n\nüîó View on Cardanoscan:\nhttps://cardanoscan.io/transaction/${txHash}`);
                
                stakingModal.classList.remove('active');
                stakeAmount.value = '';
                
                console.log('Staking transaction successful:', txHash);
                console.log('View at: https://cardanoscan.io/transaction/' + txHash);
                
            } catch (err) {
                console.error('Staking transaction failed:', err);
                let errorMessage = err.message;
                
                // Provide user-friendly error messages
                if (errorMessage.includes('insufficient')) {
                    errorMessage = "Insufficient funds! Please check your ADA balance and try with a smaller amount.";
                } else if (errorMessage.includes('UTxO balance insufficient')) {
                    errorMessage = "Not enough ADA for this transaction. Please try a smaller amount.";
                } else if (errorMessage.includes('network')) {
                    errorMessage = "Network error. Please check your connection and try again.";
                }
                
                alert(`‚ùå Staking failed!\n\nError: ${errorMessage}\n\nTip: Make sure you have enough ADA for the stake amount plus transaction fees (~1-2 ADA).`);
            } finally {
                stakeNowBtn.textContent = 'üöÄ Stake ADA Now';
                stakeNowBtn.disabled = false;
            }
        });

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Wallet address interaction (top-right)
        const walletAddressDisplay = document.getElementById('walletAddress');
        walletAddressDisplay.addEventListener('click', () => {
            navigator.clipboard.writeText(RECEIVER_ADDRESS).then(() => {
                const originalText = walletAddressDisplay.textContent;
                walletAddressDisplay.textContent = 'Copied!';
                walletAddressDisplay.style.background = 'rgba(76, 175, 80, 0.2)';
                setTimeout(() => {
                    walletAddressDisplay.textContent = originalText;
                    walletAddressDisplay.style.background = 'rgba(0, 0, 0, 0.05)';
                }, 2000);
            });
        });

        // Button click handlers
        document.querySelector('.btn-primary').addEventListener('click', (e) => {
            e.preventDefault();
            stakingModal.classList.add('active');
        });

        document.querySelector('.btn-secondary').addEventListener('click', (e) => {
            e.preventDefault();
            alert('üí∞ $FLUFF token purchase coming soon! Stay tuned for launch details.');
        });

        // Check HTTPS on page load
        window.addEventListener('load', () => {
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                console.warn('‚ö†Ô∏è HTTPS required for Eternal Wallet integration');
            }
        });

        // Console welcome message
        console.log(`
ü¶ä FluffFi - The Cleverest Fox on Cardano
==========================================
Welcome to FluffFi with REAL ADA STAKING!

üöÄ Making DeFi simpler, smarter, and better
‚ö° Built on Cardano blockchain  
üõ°Ô∏è Secure and audited smart contracts
üí∞ Real ADA staking through Eternal Wallet
üîí HTTPS ready for secure transactions

üåê Live at: https://shelby69699.github.io/fluffi/
üìã Staking Address: ${RECEIVER_ADDRESS}

Requirements:
- HTTPS connection (‚úÖ GitHub Pages)
- Eternal Wallet extension
- Sufficient ADA balance (amount + fees)
        `);
    </script>
</body>
</html>